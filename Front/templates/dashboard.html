{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block body %}

<!-- TOP BANNER (angosto) -->
<header class="top-banner">
  <div class="top-banner-inner">
    <div class="banner-left">
    </div>

    <div class="banner-right">
      <div class="banner-user">
        <span class="banner-label">Alacena de:</span>
        <span class="banner-username">{{ username if username else "Usuario" }}</span>
      </div>
      <div class="banner-actions">
        <button id="btnToggleMenu" class="hamburger" aria-label="Abrir menÃº">â˜°</button>
        <a href="{{ url_for('logout') }}" class="logout-btn">Cerrar sesiÃ³n</a>

      </div>
    </div>
  </div>
</header>

<div class="dashboard-wrap">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-inner">
      <h2 class="sidebar-title">Mi Alacena</h2>

      <nav class="nav">
        <a class="nav-link" href="{{ url_for('shopping_list') }}">ğŸ›’ Lista del supermercado</a>
        <a class="nav-link" href="{{ url_for('statistics') }}">ğŸ“Š EstadÃ­sticas</a>
        <a class="nav-link" href="{{ url_for('recipes') }}">ğŸ³ Recetas</a>
      </nav>

      <!-- push to bottom -->
      <div class="sidebar-bottom">
        <button id="btnShare" style="margin-top: 400px;" class="nav-link share-white">ğŸ”— Compartir Alacena</button>
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main">
    <div class="content-center">

      <!-- STOCK CARD (contenido intacto) -->
      <section class="stock-section">
        <h2>Stock</h2>

        <div id="stock-count">
            {{ total_items }} Ã­tems
        </div>

        <textarea id="stock-items" placeholder="Productos escaneados..."></textarea>

        <button class="scan-btn">Escanear productos</button>
      </section>

    </div>
  </main>

</div>

<!-- SHARE MODAL -->
<div id="shareModal" class="modal" aria-hidden="true">
  <div class="modal-panel">
    <button class="modal-close" id="closeModal" aria-label="Cerrar">Ã—</button>
    <h3>CompartÃ­ tu alacena</h3>
    <input id="shareLink" type="text" readonly>
    <button id="copyBtn" class="copy-btn">Copiar enlace</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Sidebar toggle (mobile)
  const sidebar = document.getElementById('sidebar');
  const btnToggle = document.getElementById('btnToggleMenu');

  btnToggle.addEventListener('click', () => {
    sidebar.classList.toggle('open');
  });

  // Share modal logic
  const sessionId = "{{ session_id }}";
  const link = window.location.origin + "/pantry?session=" + sessionId;

  const modal = document.getElementById('shareModal');
  const btnShare = document.getElementById('btnShare');
  const closeModal = document.getElementById('closeModal');
  const shareLink = document.getElementById('shareLink');
  const copyBtn = document.getElementById('copyBtn');

  btnShare.addEventListener('click', () => {
    shareLink.value = link;
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden', 'false');
    shareLink.select();
  });

  closeModal.addEventListener('click', () => {
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
  });

  copyBtn.addEventListener('click', () => {
    shareLink.select();
    document.execCommand('copy');
    alert('Â¡Link copiado!');
  });

  // Close modal clicking outside panel
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }
  });
});
</script>

{% endblock %}
